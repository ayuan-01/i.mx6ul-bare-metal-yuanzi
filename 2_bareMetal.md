### Cè¯­è¨€çŸ¥è¯†ç‚¹ï¼Œè¾¹å­¦è¾¹è®°

#### å‡½æ•°æŒ‡é’ˆ

- å‡½æ•°æŒ‡é’ˆæ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆã€‚å®ƒå…è®¸åŠ¨æ€åœ°è°ƒç”¨å‡½æ•°ï¼Œå³åœ¨è¿è¡Œä¸­å†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚

  ```C
  typedef void (*system_irq_handler_t)(unsigned int gicciar, void *param);
  ```

  è¿™æ¡è¯­å¥å°†ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆç±»å‹å®šä¹‰ä¸º `system_irq_handler_t`ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªè¿”å›ç±»å‹ä¸º `void` çš„å‡½æ•°ã€‚

  **åªè¦æ»¡è¶³è¾“å…¥å‚æ•°ç±»å‹ï¼Œè¿”å›å‚æ•°ç±»å‹ä¸å‡½æ•°æŒ‡é’ˆå®šä¹‰ç›¸åŒ¹é…ï¼Œéƒ½å¯ä»¥è¢«å‡½æ•°æŒ‡é’ˆæŒ‡å‘ã€‚**

  ç¤ºä¾‹ï¼š

  ```c
  /* å®šä¹‰å‡½æ•° */
  #include <stdio.h>
  
  // å®šä¹‰ç¬¦åˆ system_irq_handler_t ç±»å‹çš„å‡½æ•°
  void my_irq_handler(unsigned int gicciar, void *param) {
      printf("IRQ Handler called with gicciar: %u, param: %p\n", gicciar, param);
  }
  
  ```

  ```C
  // å®šä¹‰å‡½æ•°æŒ‡é’ˆç±»å‹
  typedef void (*system_irq_handler_t)(unsigned int gicciar, void *param);
  ```

  ```C
  // å£°æ˜å’Œä½¿ç”¨å‡½æ•°æŒ‡é’ˆ
  int main() {
      // å£°æ˜ä¸€ä¸ª system_irq_handler_t ç±»å‹çš„å‡½æ•°æŒ‡é’ˆ
      system_irq_handler_t handler;
  
      // å°†å‡½æ•°æŒ‡é’ˆæŒ‡å‘ my_irq_handler å‡½æ•°
      handler = my_irq_handler;
  
      // è°ƒç”¨å‡½æ•°æŒ‡é’ˆ
      handler(123, (void *)0xDEADBEEF);
  
      return 0;
  }
  ```

  

### å¯åŠ¨æµç¨‹

#### æ±‡ç¼–å¯åŠ¨ç¨‹åº

- è®¾ç½®ä¸­æ–­å‘é‡è¡¨

- å®šä¹‰ä¸­æ–­æœåŠ¡ç¨‹åº
  - å¤ä½ä¸­æ–­æœåŠ¡ç¨‹åº
    - å…³é—­å…¨å±€ä¸­æ–­(cpsid i)ã€‚
    - ä½¿ç”¨CP15åå¤„ç†å™¨ç®¡ç†STCLRå¯„å­˜å™¨ï¼Œå…³é—­ICacheï¼ŒDCacheï¼ŒMMUã€‚
    - **æ¸…é™¤BSSæ®µã€‚**é“¾æ¥è„šæœ¬(.lds)ä¸­è®¾ç½®BSSæ®µçš„èµ·å§‹å’Œç»ˆæ­¢åœ°å€ï¼Œä½¿ç”¨å¾ªç¯æ¸…é™¤è¿™ä¸ªåœ°å€èŒƒå›´å†…çš„æ‰€æœ‰å†…å®¹ã€‚
    - åˆ†åˆ«è®¾ç½®å¤„ç†å™¨çš„9ç§å·¥ä½œæ¨¡å¼å¹¶å®šä¹‰å¯¹åº”çš„SPæŒ‡é’ˆã€‚æŸ¥çœ‹å„ç§å·¥ä½œæ¨¡å¼ä¸‹16ä¸ªå¯„å­˜å™¨çš„å…±ç”¨æ¨¡å¼ã€‚æœ€åè®¾ç½®CPUå·¥ä½œæ¨¡å¼ä¸º**SVCæ¨¡å¼**
    - æ‰“å¼€IRQä¸­æ–­(cpsie i)ã€‚
    - è·³è½¬åˆ°mainå‡½æ•°ã€‚
    
  - ç¼–å†™IRQä¸­æ–­æœåŠ¡å‡½æ•°
  
    - 1. ä¿æŠ¤ç°åœºã€‚è§¦å‘ä¸­æ–­çš„æœºåˆ¶é¦–å…ˆä¼šä¿å­˜(push)ä¸€äº›å¯„å­˜å™¨ï¼Œä¸€äº›ä¸ä¼šè‡ªåŠ¨ä¿å­˜çš„å¯„å­˜å™¨(r0-r3, r12)éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¿å­˜ï¼Œ`push {lr}` ç”¨äºä¿å­˜å‡½æ•°è°ƒç”¨è¿”å›åœ°å€ã€‚
  
         ```csv
         mrs r0, spsr	// ä¿å­˜spsr
         push {r0}
         ```

      2. è¯»å–GICC_IARå¯„å­˜å™¨ï¼Œè¿™ä¸ªå¯„å­˜å™¨ä¿å­˜ç€å½“å‰å‘ç”Ÿä¸­æ–­çš„ä¸­æ–­å·ï¼Œé€šè¿‡è¿™ä¸ªä¸­æ–­å·æ¥å†³å®šæ¥è°ƒç”¨å“ªä¸ªä¸­æ–­æœåŠ¡å‡½æ•°ã€‚
  
      3. è¿›å…¥svcæ¨¡å¼ï¼Œpush {lr}ï¼Œè·³è½¬æ‰§è¡Œsystem_irqhandlerã€‚
  
      4. æ‰§è¡Œå®Œåpop {lr}ã€‚å›åˆ°irqæ¨¡å¼ã€‚
  
      5. ä¸­æ–­æ‰§è¡Œå®Œæˆï¼Œå†™GICC_EOIRå¯„å­˜å™¨ã€‚å¤„ç†å®Œå…·ä½“ä¸­æ–­åï¼Œéœ€è¦å°†å¯¹åº”çš„ä¸­æ–­IDå€¼å†™å…¥åˆ°GICC_EOIRä¸­ é€šçŸ¥GICå½“å‰å¤„ç†ä¸­æ–­å·²ç»å¤„ç†å®Œæ¯•ï¼Œå…è®¸GICåˆ†é…ä¸‹ä¸€ä¸ªä¸­æ–­ã€‚
  
      6. æ¢å¤ç°åœºã€‚
  
         ```csv
         pop {r0-r3, r12}
         subs pc, lr, #4
         /* pc = lr-4æ˜¯å› ä¸ºarmçš„æŒ‡ä»¤æ˜¯ä¸‰çº§æµæ°´çº¿ç»“æ„ï¼Œå‡å¦‚åœ¨æ‰§è¡Œ0x2000æŒ‡ä»¤æ—¶è§¦å‘ä¸­æ–­ï¼Œpcæ­¤æ—¶æ˜¯  * æŒ‡å‘0x2008çš„ï¼Œå¦‚æœä¸­æ–­ç»“æŸåè¿”å›åˆ°0x2008å¼€å§‹æ‰§è¡Œé‚£ä¹ˆå°†ä¼šæ¼æ‰ä¸€ä¸ªæŒ‡ä»¤ï¼Œè¿™ä¸ªåæœä¼šå¾ˆä¸¥é‡ */
         ```
  
  
  - Cè¯­è¨€ä¸­ç¼–å†™ä¸­æ–­ç›¸å…³å‡½æ•°ã€‚
  
    - ä¸­æ–­åˆå§‹åŒ–å‡½æ•°ã€‚
  
    - å®šä¹‰ä¸­æ–­å¤„ç†å‡½æ•°(å‡½æ•°æŒ‡é’ˆ)ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬iarï¼Œparamã€‚åˆ›å»ºåŒ…æ‹¬å‡½æ•°æŒ‡é’ˆå’Œå‚æ•°çš„ä¸­æ–­å¤„ç†ç»“æ„ä½“ã€‚
  
      ```C
      typedef struct _sys_irq_handler
      {
          system_irq_handler_t irqHandler;            /* ä¸­æ–­å¤„ç†å‡½æ•° */
          void *userParam;                            /* ä¸­æ–­å¤„ç†å‡½æ•°çš„å‚æ•° */
      }sys_irq_handle_t;
      ```
  
    - å®šä¹‰ä¸­æ–­å¤„ç†å‡½æ•°è¡¨(å­˜æ”¾ä¸­æ–­å¤„ç†å‡½æ•°ç»“æ„ä½“ç±»å‹çš„æ•°ç»„)ã€‚
  
      ```c
      static sys_irq_handle_t irqTable[NUMBER_OF_INT_VECTORS];            /* 160ä¸ª */
      ```
  
      ç›¸å½“äºç»™äº†160ä¸ªä¸­æ–­å¤„ç†å‡½æ•°ã€‚å¯¹åº”ç€ç›¸åº”çš„ä¸­æ–­å·ã€‚
  
    - åˆå§‹åŒ–ä¸­æ–­å¤„ç†å‡½æ•°è¡¨ã€‚
  
      ```c
      void system_irq_init(void)
      {
          unsigned int i = 0;
          irqNesting = 0;
          for (i = 0; i < NUMBER_OF_INT_VECTORS; i++)
          {
              irqTable[i].irqHandler = default_irqHandler;
              irqTable[i].userParam  = NULL;
          } 
      }
      ```
  
    - æ³¨å†Œä¸­æ–­å¤„ç†å‡½æ•°
  
      ```c
      void system_register_irqhandler(IRQn_Type irq, system_irq_handler_t handler, void *userparam)
      {
          irqTable[irq].irqHandler = handler;
          irqTable[irq].userParam  = userparam;
      }
      ```
  
    - å…·ä½“çš„ä¸­æ–­å¤„ç†å‡½æ•°
  
      ```c
      void system_irqhandler(unsigned int gicciar)
      {
          /* æ£€æŸ¥ä¸­æ–­ID */
          uint32_t intNum = gicciar & 0x3ff;
          if(intNum >= NUMBER_OF_INT_VECTORS)
          {
              return;
          }
          irqNesting++;
          /* æ ¹æ®ä¸­æ–­IDå·ï¼Œè¯»å–ä¸­æ–­å¤„ç†å‡½æ•°ï¼Œç„¶åæ‰§è¡Œ */
          irqTable[intNum].irqHandler(intNum, irqTable[intNum].userParam);
          irqNesting--;
      }
      ```
  
      

#### é“¾æ¥è„šæœ¬

##### é“¾æ¥è„šæœ¬å…·ä½“è§£é‡Š

è¿™ä¸ªä»£ç æ®µæ˜¯ä¸€ä¸ªGNU LDï¼ˆLinker Scriptï¼‰è„šæœ¬ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å°†ç¨‹åºçš„ä¸åŒéƒ¨åˆ†å¸ƒå±€åˆ°å†…å­˜ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™ä¸ªè„šæœ¬å®šä¹‰äº†å„ä¸ªæ®µï¼ˆsectionsï¼‰åœ¨å†…å­˜ä¸­çš„ä½ç½®å’Œå¯¹é½æ–¹å¼ã€‚

1. **èµ·å§‹åœ°å€è®¾ç½®**:

   ```ld
   . = 0X87800000;
   ```

   è¿™è¡Œä»£ç å°†é“¾æ¥å™¨çš„å½“å‰ä½ç½®ï¼ˆå³å†…å­˜åœ°å€ï¼‰è®¾ç½®ä¸º`0x87800000`ã€‚è¿™æ„å‘³ç€æ¥ä¸‹æ¥çš„æ‰€æœ‰æ®µéƒ½ä¼šä»è¿™ä¸ªåœ°å€å¼€å§‹æ”¾ç½®ã€‚

2. **.textæ®µ**:

   ```ld
   .text : 
   {
       obj/start.o
       *(.text)
   }
   ```

   `.text`æ®µé€šå¸¸åŒ…å«ç¨‹åºçš„ä»£ç éƒ¨åˆ†ã€‚è¿™é‡ŒæŒ‡å®šäº†`obj/start.o`æ–‡ä»¶ä¸­çš„å†…å®¹é¦–å…ˆæ”¾å…¥`.text`æ®µï¼Œç„¶åå°†æ‰€æœ‰è¾“å…¥æ–‡ä»¶ä¸­çš„`.text`æ®µå†…å®¹ä¾æ¬¡æ”¾å…¥ã€‚

3. **.rodataæ®µ**:

   ```ld
   .rodata ALIGN(4) : {*(.rodata*)}
   ```

   `.rodata`æ®µç”¨äºå­˜å‚¨åªè¯»æ•°æ®ã€‚è¿™é‡Œå°†æ‰€æœ‰è¾“å…¥æ–‡ä»¶ä¸­çš„`.rodata`æ®µå†…å®¹æ”¾å…¥ï¼Œå¹¶ä¸”å°†å…¶å¯¹é½åˆ°4å­—èŠ‚è¾¹ç•Œã€‚

4. **.dataæ®µ**:

   ```ld
   .data ALIGN(4) : {*(.data)}
   ```

   `.data`æ®µç”¨äºå­˜å‚¨å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚è¿™é‡Œå°†æ‰€æœ‰è¾“å…¥æ–‡ä»¶ä¸­çš„`.data`æ®µå†…å®¹æ”¾å…¥ï¼Œå¹¶ä¸”å°†å…¶å¯¹é½åˆ°4å­—èŠ‚è¾¹ç•Œã€‚

5. **å¯¹é½æŒ‡é’ˆ**:

   ```ld
   . = ALIGN(4);
   ```

   è¿™è¡Œä»£ç å°†å½“å‰ä½ç½®å¯¹é½åˆ°4å­—èŠ‚è¾¹ç•Œã€‚

6. **__bss_startç¬¦å·**:

   ```ld
   __bss_start = .;
   ```

   å®šä¹‰ä¸€ä¸ªç¬¦å·`__bss_start`ï¼Œå…¶å€¼ä¸ºå½“å‰ä½ç½®ï¼ˆå³`bss`æ®µçš„èµ·å§‹åœ°å€ï¼‰ã€‚

7. **.bssæ®µ**:

   ```ld
   .bss ALIGN(4) : {*(.bss) *(common)}
   ```

   `.bss`æ®µç”¨äºå­˜å‚¨æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚è¿™é‡Œå°†æ‰€æœ‰è¾“å…¥æ–‡ä»¶ä¸­çš„`.bss`æ®µå’Œ`common`æ®µå†…å®¹æ”¾å…¥ï¼Œå¹¶ä¸”å°†å…¶å¯¹é½åˆ°4å­—èŠ‚è¾¹ç•Œã€‚

8. **__bss_endç¬¦å·**:

   ```ld
   __bss_end = .;
   ```

   å®šä¹‰ä¸€ä¸ªç¬¦å·`__bss_end`ï¼Œå…¶å€¼ä¸ºå½“å‰ä½ç½®ï¼ˆå³`bss`æ®µçš„ç»“æŸåœ°å€ï¼‰ã€‚

#### CP15åå¤„ç†å™¨å¯„å­˜å™¨

CP15å¯„å­˜å™¨æ˜¯ARMæ¶æ„ä¸­çš„åå¤„ç†å™¨15å¯„å­˜å™¨ï¼Œä¸»è¦ç”¨äºé…ç½®å’Œç®¡ç†ç³»ç»Ÿæ§åˆ¶ã€å†…å­˜ç®¡ç†ã€è°ƒè¯•ç­‰åŠŸèƒ½ã€‚CP15å¯„å­˜å™¨åœ¨ARMå¤„ç†å™¨ä¸­æ‰®æ¼”ç€å…³é”®è§’è‰²ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¸»è¦åŠŸèƒ½å’Œä½œç”¨ï¼š

1. **ç³»ç»Ÿæ§åˆ¶**ï¼š
   - æ§åˆ¶å¯„å­˜å™¨ï¼ˆå¦‚SCTLRï¼‰ï¼šç”¨äºé…ç½®å¤„ç†å™¨çš„è¿è¡Œæ¨¡å¼å’Œç‰¹æ€§ï¼Œä¾‹å¦‚å¯ç”¨æˆ–ç¦ç”¨ç¼“å­˜ã€MMUã€å¼‚å¸¸å¤„ç†ç­‰ã€‚
2. **å†…å­˜ç®¡ç†**ï¼š
   - TLBï¼ˆTranslation Lookaside Bufferï¼‰æ§åˆ¶ï¼šç®¡ç†TLBçš„åˆ·æ–°ã€æ— æ•ˆåŒ–ç­‰æ“ä½œã€‚
   - é¡µè¡¨åŸºåœ°å€å¯„å­˜å™¨ï¼šå­˜å‚¨é¡µè¡¨çš„åŸºåœ°å€ï¼Œç”¨äºåœ°å€è½¬æ¢ã€‚
3. **ä¸­æ–­å’Œå¼‚å¸¸å¤„ç†**ï¼š
   - ä¸­æ–­æ§åˆ¶å¯„å­˜å™¨ï¼šé…ç½®ä¸­æ–­çš„ä¼˜å…ˆçº§ã€ä½¿èƒ½çŠ¶æ€ç­‰ã€‚
   - *å¼‚å¸¸å‘é‡è¡¨åŸºåœ°å€å¯„å­˜å™¨ï¼šæŒ‡å®šå¼‚å¸¸å‘é‡è¡¨çš„åœ°å€*ã€‚
4. **æ€§èƒ½ç›‘æ§**ï¼š
   - æ€§èƒ½ç›‘æ§å¯„å­˜å™¨ï¼šç”¨äºæ€§èƒ½è®¡æ•°ã€äº‹ä»¶ç›‘æ§ï¼Œå¸®åŠ©å¼€å‘äººå‘˜ä¼˜åŒ–ä»£ç æ€§èƒ½ã€‚
5. **è°ƒè¯•å’Œè·Ÿè¸ª**ï¼š
   - è°ƒè¯•æ§åˆ¶å¯„å­˜å™¨ï¼šé…ç½®è°ƒè¯•åŠŸèƒ½ã€æ–­ç‚¹ã€è§‚å¯Ÿç‚¹ç­‰ã€‚
   - è·Ÿè¸ªæ§åˆ¶å¯„å­˜å™¨ï¼šé…ç½®è·Ÿè¸ªåŠŸèƒ½ï¼Œç”¨äºç¨‹åºæ‰§è¡Œæµçš„è®°å½•å’Œåˆ†æã€‚
6. **ç”µæºç®¡ç†**ï¼š
   - ç”µæºæ§åˆ¶å¯„å­˜å™¨ï¼šé…ç½®ä½åŠŸè€—æ¨¡å¼ã€èŠ‚èƒ½ç‰¹æ€§ç­‰ã€‚

CP15å¯„å­˜å™¨åœ¨ARMå¤„ç†å™¨çš„è¿è¡Œå’Œç®¡ç†ä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œä½¿ç³»ç»Ÿèƒ½å¤Ÿçµæ´»ã€é«˜æ•ˆåœ°è¿›è¡Œé…ç½®å’Œæ§åˆ¶ã€‚



#### SCTLRå¯„å­˜å™¨

SCTLRï¼ˆSystem Control Registerï¼‰æ˜¯ARMæ¶æ„ä¸­çš„ä¸€ä¸ªé‡è¦å¯„å­˜å™¨ï¼Œä½äºCP15åå¤„ç†å™¨ä¸­ã€‚å®ƒç”¨äºæ§åˆ¶å¤„ç†å™¨çš„å„ç§ç³»ç»Ÿçº§ç‰¹æ€§å’Œæ“ä½œæ¨¡å¼ã€‚SCTLRçš„ä½œç”¨éå¸¸å¹¿æ³›ï¼Œä¸‹é¢æ˜¯å…¶ä¸»è¦åŠŸèƒ½å’Œæ§åˆ¶ä½ï¼š

1. **MMUå¯ç”¨**ï¼š
   - Mä½ï¼šæ§åˆ¶MMUï¼ˆå†…å­˜ç®¡ç†å•å…ƒï¼‰çš„å¯ç”¨å’Œç¦ç”¨ã€‚
     - 0ï¼šç¦ç”¨MMU
     - 1ï¼šå¯ç”¨MMU
2. **å¯¹é½æ£€æŸ¥**ï¼š
   - Aä½ï¼šæ§åˆ¶æœªå¯¹é½æ•°æ®è®¿é—®çš„æ£€æŸ¥ã€‚
     - 0ï¼šç¦ç”¨å¯¹é½æ£€æŸ¥
     - 1ï¼šå¯ç”¨å¯¹é½æ£€æŸ¥
3. **æ•°æ®ç¼“å­˜å¯ç”¨**ï¼š
   - Cä½ï¼šæ§åˆ¶æ•°æ®ç¼“å­˜çš„å¯ç”¨å’Œç¦ç”¨ã€‚
     - 0ï¼šç¦ç”¨æ•°æ®ç¼“å­˜
     - 1ï¼šå¯ç”¨æ•°æ®ç¼“å­˜
4. **æŒ‡ä»¤ç¼“å­˜å¯ç”¨**ï¼š
   - Iä½ï¼šæ§åˆ¶æŒ‡ä»¤ç¼“å­˜çš„å¯ç”¨å’Œç¦ç”¨ã€‚
     - 0ï¼šç¦ç”¨æŒ‡ä»¤ç¼“å­˜
     - 1ï¼šå¯ç”¨æŒ‡ä»¤ç¼“å­˜
5. **ç³»ç»Ÿä¿æŠ¤**ï¼š
   - Sä½ï¼šé…ç½®ç³»ç»Ÿä¿æŠ¤ï¼Œä½¿ç³»ç»ŸåŒºå’Œç”¨æˆ·åŒºçš„è®¿é—®æƒé™ä¸åŒã€‚
     - 0ï¼šç¦ç”¨ç³»ç»Ÿä¿æŠ¤
     - 1ï¼šå¯ç”¨ç³»ç»Ÿä¿æŠ¤
6. **å†™ç¼“å†²åŒº**ï¼š
   - Bä½ï¼šæ§åˆ¶å†™ç¼“å†²åŒºçš„å¯ç”¨å’Œç¦ç”¨ã€‚
     - 0ï¼šç¦ç”¨å†™ç¼“å†²åŒº
     - 1ï¼šå¯ç”¨å†™ç¼“å†²åŒº
7. **å°ç«¯æ¨¡å¼/å¤§ç«¯æ¨¡å¼**ï¼š
   - Eä½ï¼šé…ç½®å¤„ç†å™¨çš„å­—èŠ‚åºæ¨¡å¼ã€‚
     - 0ï¼šå°ç«¯æ¨¡å¼
     - 1ï¼šå¤§ç«¯æ¨¡å¼
8. **å¯¹ç§°å¤šå¤„ç†æ”¯æŒ**ï¼š
   - SMPä½ï¼šå¯ç”¨æˆ–ç¦ç”¨å¯¹ç§°å¤šå¤„ç†ï¼ˆSMPï¼‰æ”¯æŒã€‚
     - 0ï¼šç¦ç”¨SMP
     - 1ï¼šå¯ç”¨SMP
9. **æŒ‡ä»¤é¢„å–**ï¼š
   - Zä½ï¼šæ§åˆ¶æŒ‡ä»¤é¢„å–ã€‚
     - 0ï¼šç¦ç”¨é¢„å–
     - 1ï¼šå¯ç”¨é¢„å–
10. **åˆ†æ”¯é¢„æµ‹**ï¼š
    - Pä½ï¼šæ§åˆ¶åˆ†æ”¯é¢„æµ‹åŠŸèƒ½ã€‚
      - 0ï¼šç¦ç”¨åˆ†æ”¯é¢„æµ‹
      - 1ï¼šå¯ç”¨åˆ†æ”¯é¢„æµ‹

SCTLRå¯„å­˜å™¨ä¸­çš„è¿™äº›æ§åˆ¶ä½ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿæ ¹æ®éœ€æ±‚é…ç½®å¤„ç†å™¨çš„è¿è¡Œæ¨¡å¼å’Œç‰¹æ€§ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæ“ä½œç³»ç»Ÿæˆ–å›ºä»¶ä¼šè®¾ç½®è¿™äº›ä½ï¼Œä»¥ç¡®ä¿å¤„ç†å™¨ä»¥é¢„æœŸçš„æ–¹å¼è¿è¡Œã€‚



#### ä¸­æ–­åç§»åœ°å€å’Œç¨‹åºå…¥å£åœ°å€

1. ä¸­æ–­å‘é‡è¡¨å’Œç¨‹åºèµ·å§‹åœ°å€é€šå¸¸ä¸ä¼šè®¾ç½®ç›¸åŒçš„å€¼ï¼Œè¿™ä¼šå¯¼è‡´ä¸¤è€…ä¹‹é—´çš„å†²çªã€‚ç„¶è€Œï¼Œåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ç‰¹åˆ«æ˜¯åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡ç‰¹æ®Šçš„é…ç½®å’Œä½¿ç”¨ä¸åŒæ–¹æ³•æ¥å®ç°è¿™ç§è®¾ç½®ã€‚
2. ä¸­æ–­å‘é‡è¡¨åœ¨_start:ä¸­è®¾ç½®ã€‚

### GPIOä¸­æ–­ç¨‹åº

- æ±‡ç¼–æ–‡ä»¶

  - åœ¨æ±‡ç¼–å¯åŠ¨ç¨‹åºä¸­é…ç½®å¥½ä¸­æ–­å‘é‡è¡¨å’Œä¸­æ–­æœåŠ¡å‡½æ•°IRQ_Hanlderã€‚

- BSP_INT(ä¸­æ–­é…ç½®æ–‡ä»¶)

  - åˆ›å»ºä¸­æ–­å‡½æ•°æŒ‡é’ˆç±»å‹ã€‚
  - åˆ›å»ºä¸­æ–­å‡½æ•°ç»“æ„ä½“ï¼ŒåŒ…æ‹¬ä¸­æ–­æœåŠ¡å‡½æ•°å’Œä¸­æ–­æœåŠ¡å‡½æ•°å‚æ•°ã€‚
  - åˆ›å»ºå˜é‡è®°å½•ä¸­æ–­åµŒå¥—æ•°é‡ã€‚
  - åˆ›å»ºä¸­æ–­å¤„ç†å‡½æ•°è¡¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚
  - åˆ›å»ºåˆå§‹åŒ–ä¸­æ–­å‡½æ•°è¡¨å‡½æ•°ï¼Œä¸­æ–­æ•°é‡æ¸…é›¶ã€‚
  - ä¸­æ–­åˆå§‹åŒ–å‡½æ•°(åˆå§‹åŒ–GICï¼Œåˆå§‹åŒ–ä¸­æ–­å‡½æ•°è¡¨ï¼Œè®¾ç½®ä¸­æ–­å‘é‡åç§»)ã€‚
  - ä¸­æ–­å¤„ç†æ³¨å†Œå‡½æ•°ã€‚
  - ç³»ç»Ÿä¸­æ–­å¤„ç†å‡½æ•°(IRQè·³è½¬)ï¼Œæ£€æŸ¥ä¸­æ–­å¤„ç†å‡½æ•°IDå·ï¼Œä¸­æ–­æ•°åŠ ä¸€ï¼Œè¿è¡Œä¸­æ–­irqTable[intNum]ã€‚

- BSP_GPIOä¸­æ–­æ–‡ä»¶é…ç½®

  - å®šä¹‰æšä¸¾æ•°æ®ä¸­æ–­å‡ºå‘ç±»å‹gpio_interrupt_mode_tã€‚
  - GPIOé…ç½®ç»“æ„ä½“ä¸­åŠ ä¸Šä¸­æ–­ç±»å‹ã€‚
  - GPIOä¸­æ–­é…ç½®å‡½æ•°ï¼Œè¾“å…¥å‚æ•°GPIO*ï¼Œpinï¼Œgpio_interrupt_mode_tã€‚
    - å®šä¹‰icræŒ‡é’ˆã€‚å¹¶`icrShift = pin;`
    - SELç½®1æ—¶è®¾ç½®ICRå¯„å­˜å™¨æ— æ•ˆï¼Œæ‰€ä»¥ç»™æ­¤å¯„å­˜å™¨æ¸…é›¶ã€‚
    - ä½16ä½`icr = &(base->ICR1);`é«˜16ä½`icrShift -= 16;`
    - åˆ¤æ–­ä¸­æ–­å‡ºå‘ç±»å‹ï¼Œè®¾ç½®ICRå¯„å­˜å™¨ã€‚
  - GPIOåˆå§‹åŒ–å‡½æ•°ä¸­åŠ å…¥GPIOä¸­æ–­é…ç½®å‡½æ•°ã€‚
  - å®šä¹‰å‡½æ•°ï¼šä½¿èƒ½GPIOä¸­æ–­ï¼Œç¦æ­¢GPIOä¸­æ–­ï¼Œæ¸…é™¤ä¸­æ–­æ ‡å¿—ä½(è¯¥å‡½æ•°ä½œç”¨ä½é€€å‡ºä¸­æ–­)

- BSP_EXITå¤–éƒ¨ä¸­æ–­é…ç½®æ–‡ä»¶

  - å¤–éƒ¨ä¸­æ–­åˆå§‹åŒ–å‡½æ•°

    - å®šä¹‰gpioé…ç½®ç»“æ„ä½“

    - å¼•è„šå¤ç”¨ï¼Œç”µæ°”å±æ€§ä¸Šæ‹‰è¾“å…¥ã€‚

    - GPIOåˆå§‹åŒ–ã€‚

    - GICä½¿èƒ½ä¸­æ–­ã€‚

    - æ³¨å†Œä¸­æ–­æœåŠ¡å‡½æ•°ã€‚

    - gpioä¸­æ–­ä½¿èƒ½ã€‚

      ```c
      GIC_EnableIRQ(GPIO1_Combined_16_31_IRQn);
      system_register_irqhandler(GPIO1_Combined_16_31_IRQn, gpio1_io18_irqhandler, NULL);
      /* ä½¿èƒ½ä¸­æ–­ä¹‹å‰éœ€è¦å…ˆæ³¨å†Œä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œå¦åˆ™ä½¿èƒ½åæ¥ä¸­æ–­å¯èƒ½ä¼šå‡ºé—®é¢˜ */
      gpio_enableint(GPIO1, 18);
      ```

  - ä¸­æ–­æœåŠ¡å‡½æ•°ã€‚

### EPITä¸­æ–­

- ä¸­æ–­åˆå§‹åŒ–å‡½æ•°

  - è¾“å…¥å‚æ•°ä¸ºåˆ†é¢‘å€¼å’Œè½½å…¥å€¼ã€‚

    ```c
    void epit1_int(unsigned int frac, unsigned int value)
    ```

  - åˆ¤æ–­åˆ†é¢‘æ•°æ˜¯å¦å¤§äº4095ã€‚

  - é…ç½®EPITä¸­æ–­å¯„å­˜å™¨ã€‚

    ```c
    /* é…ç½®EPITçš„CRå¯„å­˜å™¨ */
    EPIT1->CR = 0;
    /**
      * bit1=1ï¼Œè®¡æ•°å™¨ä»loadå€¼æˆ–è€…0xffffffffå¼€å§‹è®¡æ•°
      * bit2=1ä½¿èƒ½æ¯”è¾ƒä¸­æ–­
      * bit3=1ä»å¯„å­˜å™¨è®°å½•çš„å€¼é‡æ–°è®¡æ•°
      * bit4-15åˆ†é…å€¼frac
      * bit24=1è®¾ç½®å®šæ—¶å™¨æ—¶é’Ÿæº
      */
    EPIT1->CR = (1 << 1) | (1 << 2) | (1 << 3) | (frac << 4) | (1 << 24);
    EPIT1->LR = value;
    EPIT1->CMPR =0;
    ```

  - GICä½¿èƒ½

  - æ³¨å†Œä¸­æ–­æœåŠ¡å‡½æ•°

  - å¼€å¯ä¸­æ–­

    ```c
    /* åˆå§‹åŒ–ä¸­æ–­ */
    GIC_EnableIRQ(EPIT1_IRQn);
    system_register_irqhandler(EPIT1_IRQn, epit1_irqhandler, NULL);   
    /* æ‰“å¼€EPIT1 */ 
    EPIT1->CR |= (1 << 0);
    ```

- EPIT1ä¸­æ–­æœåŠ¡å‡½æ•°

  ```c
  void epit1_irqhandler(unsigned int gicciar, void *param)
  {
      static unsigned char state = 0;
      state = !state;
      if (EPIT1->SR & (1 << 0))   /* ä¸­æ–­å‘ç”Ÿäº† */
      {
          led_switch(LED0, state);
      }
      /* æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ */
      EPIT1->SR |= (1 << 0);
  }
  ```

### å®šæ—¶å™¨æŒ‰é”®æ¶ˆæŠ–

- å¤–éƒ¨ä¸­æ–­åˆå§‹åŒ–

  ```c
  void keyfilter_init(void)
  {
      gpio_pin_config_t key_config;
      IOMUXC_SetPinMux(IOMUXC_UART1_CTS_B_GPIO1_IO18, 0);                 //è®¾ç½®å¼•è„šå¤ç”¨ï¼ŒGPIO1_18
      IOMUXC_SetPinConfig(IOMUXC_UART1_CTS_B_GPIO1_IO18, 0xf080);         //è®¾ç½®å¼•è„šç”µæ°”å±æ€§ è®¾ç½®ä¸ºä¸Šæ‹‰è¾“å…¥
  
      /* GPIOåˆå§‹åŒ– */
      key_config.direction = kGPIO_DigitalInput;
      key_config.interruptMode = kGPIO_IntFallingEdge;
      key_config.outputLogic = 1;
      gpio_init(GPIO1, 18, &key_config);      //è®¾ç½®å¼•è„šä¸ºè¾“å…¥
  
      GIC_EnableIRQ(GPIO1_Combined_16_31_IRQn);
      system_register_irqhandler(GPIO1_Combined_16_31_IRQn, gpio1_16_32_irqhandler, NULL);
      /* ä½¿èƒ½ä¸­æ–­ä¹‹å‰éœ€è¦å…ˆæ³¨å†Œä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œå¦åˆ™ä½¿èƒ½åæ¥ä¸­æ–­å¯èƒ½ä¼šå‡ºé—®é¢˜ */
      gpio_enableint(GPIO1, 18);
      filtertimer_init(66000000/100); //å®šæ—¶å™¨åˆå§‹åŒ–æ”¾åœ¨å¤–éƒ¨ä¸­æ–­åˆå§‹åŒ–å‡½æ•°ä¸­
  }
  ```

  

- å®šæ—¶å™¨ä¸­æ–­åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–å®šæ—¶å™¨,ä½†ä¸ä½¿èƒ½ï¼Œè¦åœ¨æŒ‰é”®ä¸‹é™æ²¿ä¸­æ–­è§¦å‘ä¹‹ååœ¨æŒ‰é”®çš„ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­å¼€å¯ï¼Œå¼€å§‹è®¡æ•°ï¼Œè®¡æ•°æ»¡è¶³å®šä¹‰çš„æ—¶é—´è§¦å‘å®šæ—¶å™¨ä¸­æ–­ã€‚

  ```c
  void filtertimer_init(unsigned int value)
  {
      EPIT1->CR = 0;
      EPIT1->CR = (1 << 1) | (1 << 2) | (1 << 3) | (1 << 24);
      EPIT1->LR = value;
      EPIT1->CMPR =0;
      
      /* åˆå§‹åŒ–ä¸­æ–­ */
      GIC_EnableIRQ(EPIT1_IRQn);
      system_register_irqhandler(EPIT1_IRQn, filtertimer_irqhandler, NULL);   
  }
  ```

- å¤–éƒ¨ä¸­æ–­æœåŠ¡å‡½æ•°

  ```c
  void gpio1_16_32_irqhandler(unsigned int gicciar, void *param)
  {
      /* å¼€å¯å®šæ—¶å™¨ */
      filtertimer_restart(66000000/100);
      /* æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ */
      gpio_clearintflags(GPIO1, 18);
  }
  ```

- å®šæ—¶å™¨ä¸­æ–­æœåŠ¡å‡½æ•°

  ```c
  void filtertimer_irqhandler(unsigned int gicciar, void *param)
  {
      static unsigned char state = OFF;
      
      if(EPIT1->SR & (1 << 0))
      {
          /* å…³é—­å®šæ—¶å™¨ */
          filtertimer_stop();
          if (gpio_pinread(GPIO1, 18) == 0)
          {
              state = !state;
              beep_switch(state);
          }
      }
      /* æ¸…é™¤ä¸­æ–­æ ‡å¿—ä½ */
      EPIT1->SR |= (1 << 0);
  }
  ```

- å…³é—­EPIT1å®šæ—¶å™¨

  ```C
  /* å…³é—­EPIT1å®šæ—¶å™¨ */
  void filtertimer_stop(void)
  {
      EPIT1->CR &= ~(1 << 0);
  }
  ```

  

- å¼€å¯EPIT1å®šæ—¶å™¨

  ```c
  /* å¼€å¯EPIT1å®šæ—¶å™¨ */
  void filtertimer_restart(unsigned int value)
  {
      EPIT1->CR &= ~(1 << 0);
      EPIT1->LR = value;
      EPIT1->CR |= ( 1<< 0);
  }
  ```

### GPTå®šæ—¶å™¨å®ç°é«˜ç²¾åº¦å»¶æ—¶

#### å®éªŒä¸€ï¼šè¿›å…¥GPTä¸­æ–­å®ç°LEDé—ªçƒ

- å»¶æ—¶åˆå§‹åŒ–å‡½æ•°

  - åˆå§‹åŒ–ç›¸å…³å¯„å­˜å™¨

    CRå¯„å­˜å™¨ï¼Œå…ˆå…¨éƒ¨æ¸…é›¶ï¼Œè½¯ä»¶å¤ä½ï¼Œè®¾ç½®åˆå§‹å€¼ï¼Œæ—¶é’Ÿæºï¼Œè®¾ç½®æ¨¡å¼ä¸ºrestartæ¨¡å¼å³æ¯”è¾ƒä¸­æ–­åé‡æ–°è®¡æ—¶ã€‚è®¾ç½®åˆ†é¢‘å€¼ï¼Œä½¿å®šæ—¶å™¨é¢‘ç‡ä¸º1Mã€‚è®¾ç½®OCR[0]ä¸º1000000/2å³500msè¿›å…¥ä¸€æ¬¡æ¯”è¾ƒä¸­æ–­ã€‚

  - æ‰“å¼€é€šé“1æ¯”è¾ƒä¸­æ–­ï¼ŒGICä½¿èƒ½ï¼Œæ³¨å†Œä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œæ‰“å¼€GPT1

  ```c
  /* å»¶æ—¶åˆå§‹åŒ–å‡½æ•° */
  void delay_init(void)
  {
      GPT1->CR = 0;
  
      /* è½¯å¤ä½ï¼Œç½®1å¤ä½ï¼Œç­‰å¾…è‡ªåŠ¨æ¸…é›¶ */
      GPT1->CR = (1 << 15);
      while ((GPT1->CR >> 15) & 0x01);
  
      /**
       * bit1: 1ï¼šåˆå§‹å€¼ä¸º0
       * bit6-8: 1ï¼šæ—¶é’Ÿæºé€‰æ‹©ipg_clk = 66MHz
       * bit9: 0ï¼šrestartæ¨¡å¼
       */
      GPT1->CR |= (1 << 1) | (1 << 6);
  
      /* åˆ†é¢‘è®¾ç½®,0-11ä½è®¾ç½®åˆ†é¢‘å€¼ */
      GPT1->PR = 65;      // 66åˆ†é¢‘
      /* é…ç½®è¾“å‡ºæ¯”è¾ƒé€šé“ */
      GPT1->OCR[0] = 1000000/2;    /* è®¾ç½®ä¸­æ–­å‘¨æœŸä¸º500ms */
  
      /* æ‰“å¼€é€šé“1æ¯”è¾ƒä¸­æ–­ */
      GPT1->IR = 1 << 0;
  
      GIC_EnableIRQ(GPT1_IRQn);
      system_register_irqhandler(GPT1_IRQn, gpt1_irqhandler, NULL);
      GPT1->CR |= (1 << 0);   /* æ‰“å¼€GPT1 */
  }
  
  void gpt1_irqhandler(unsigned int gicciar, void *param)
  {
      static unsigned char state  = 0;
  
      /* åˆ¤æ–­æ˜¯å“ªä¸ªä¸­æ–­ */
      if (GPT1->SR & (1 << 0))
      {
          state = !state;
          led_switch(LED0, state);
      }
  
      /* æ¸…é™¤ä¸­æ–­çŠ¶æ€ */
      GPT1->SR |= (1 << 0);
  }
  ```

  

#### å®éªŒäºŒï¼šé«˜ç²¾åº¦å»¶æ—¶

- å»¶æ—¶åˆå§‹åŒ–å‡½æ•°

  ```c
  /* å»¶æ—¶åˆå§‹åŒ–å‡½æ•° */
  void delay_init(void)
  {
      GPT1->CR = 0;
  
      /* è½¯å¤ä½ï¼Œç½®1å¤ä½ï¼Œç­‰å¾…è‡ªåŠ¨æ¸…é›¶ */
      GPT1->CR = (1 << 15);
      while ((GPT1->CR >> 15) & 0x01);
  
      /**
       * bit1: 1ï¼šåˆå§‹å€¼ä¸º0
       * bit6-8: 1ï¼šæ—¶é’Ÿæºé€‰æ‹©ipg_clk = 66MHz
       * bit9: 0ï¼šrestartæ¨¡å¼
       */
      GPT1->CR |= (1 << 1) | (1 << 6);
  
      /* åˆ†é¢‘è®¾ç½®,0-11ä½è®¾ç½®åˆ†é¢‘å€¼ */
      GPT1->PR = 65;      // 66åˆ†é¢‘
      /* 1Mçš„é¢‘ç‡è®¡1ä¸ªæ•°å°±æ˜¯1us */
      GPT1->OCR[0] = 0xffffffff;
  
      GPT1->CR |= (1 << 0);   /* æ‰“å¼€GPT1 */
  }
  ```

  

- uså»¶æ—¶å‡½æ•°

  ```c
  void delay_us(unsigned int usdelay)
  {
      unsigned long oldcnt, newcnt;
      unsigned long tcntvalue = 0;
  
      oldcnt = GPT1->CNT;
      while (1)
      {
          newcnt = GPT1->CNT;
          if(newcnt != oldcnt)
          {
              if(newcnt > oldcnt)
              {
                  tcntvalue += newcnt - oldcnt;
              }
              else
              {
                  tcntvalue += 0xffffffff - oldcnt + newcnt;
              }
              oldcnt = newcnt;
              if (tcntvalue >= usdelay)
              {
                  break;
              }
          } 
      }
  }
  ```

  

- mså»¶æ—¶å‡½æ•°

```c
void delay_ms(unsigned int msdelay)
{
    unsigned int i = 0;
    for (i = 0; i < msdelay; i++)
    {
        delay_us(1000);
    }    
}
```

- ä¸»å‡½æ•°ä¸­ä½¿ç”¨é«˜ç²¾åº¦å»¶æ—¶å‡½æ•°å®ç°LEDé—ªçƒã€‚

### UART

- ä¸²å£IOåˆå§‹åŒ–å‡½æ•°

- ä¸²å£åˆå§‹åŒ–

  - åˆå§‹åŒ–IO

  - åˆå§‹åŒ–å¤ä½UART1

  - é…ç½®ç›¸å…³å¯„å­˜å™¨

    - UCR1ä¸º0
    - UCR2é…ç½®æ•°æ®ä½ï¼Œå¥‡å¶æ ¡éªŒä½ï¼Œåœæ­¢ä½
    - UCR3çš„bti2å¿…é¡»ä¸º1

  - è®¾ç½®æ³¢ç‰¹ç‡

    Baud Rate = ğ‘…ğ‘’ğ‘“ ğ¹ğ‘Ÿğ‘’ğ‘ / (16 Ã—(ğ‘ˆğµğ‘€ğ‘… + 1) / (ğ‘ˆğµğ¼ğ‘… + 1)) 

  - ä½¿èƒ½ä¸²å£

  ```c
  /**
   * @brief åˆå§‹åŒ–UART
   * @brief æ³¢ç‰¹ç‡å›ºå®š115200
   * @param void:void
   */
  void uart_init(void)
  {
      /* åˆå§‹åŒ–ä¸²å£IO */
      uart_io_init();
  
      /* åˆå§‹åŒ–UART1 */
      uart_disable(UART1);    /* å…³é—­UART1 */
      uart_softreset(UART1);   /* å¤ä½UART1 */
  
      /* é…ç½®UART1 */
      UART1->UCR1 = 0;
  
      /* é…ç½®UART1çš„æ•°æ®ä½ï¼Œå¥‡å¶æ ¡éªŒï¼Œåœæ­¢ä½ç­‰ */
      /* bit1-2å‘é€å’Œæ¥æ”¶çš„ä½¿èƒ½ bit5è®¾ç½®æ•°æ®ä½é•¿åº¦8ä½ bit6ä¸€ä½åœæ­¢ä½ bit14å¿½ç•¥RTSè„š */
      UART1->UCR2 = 0;
      UART1->UCR2 |= (1 << 1) | (1 << 2) | (1 << 5) | (1 << 14);
  
      /* bit2å¿…é¡»ä¸º1 */
      UART1->UCR3 |= (1 << 2);
  
      /* è®¾ç½®æ³¢ç‰¹ç‡ */
      UART1->UFCR &= ~(7 << 7);   /* å¯¹RFDIVè¿›è¡Œæ¸…é›¶ */
      UART1->UFCR = 5 << 7;       /* 1åˆ†é¢‘ï¼Œ80M */
      UART1->UBIR = 71;
      UART1->UBMR = 3124;
      /* ä½¿èƒ½ä¸²å£ */
      uart_enable(UART1);
  }
  
  ```

- æ‰“å¼€ä¸²å£

  ```c
  /**
   * @brief æ‰“å¼€ä¸²å£
   * @param UART_Type
   */
  void uart_enable(UART_Type *base)
  {
      base->UCR1 |= (1 << 0);
  }
  ```

- å…³é—­ä¸²å£

  ```c
  /**
   * @brief å…³é—­ä¸²å£
   * @param UART_Type
   */
  void uart_disable(UART_Type *base)
  {
      base->UCR1 &= ~(1 << 0);
  }
  ```

- å¤ä½ä¸²å£

  ```c
  /**
   * @brief å¤ä½UART
   * @param UART_Type
   */
  void uart_softreset(UART_Type *base)
  {
      base->UCR2 &= ~(1 << 0);
      while((base->UCR2 & 0x01) == 0);
  }
  ```

- å‘é€å­—ç¬¦

  ```c
  void putc(unsigned char c)
  {
      /* åœ¨åˆ¤æ–­ä¸Šæ¬¡æ•°æ®æ˜¯å¦å‘é€å®Œæˆ */
      while (((UART1->USR2 >> 3) & 0x01) == 0); /* æ•°æ®æ˜¯å¦åœ¨å‘é€ä¸­ */
      UART1->UTXD = c;
  }
  ```

- æ¥æ”¶å­—ç¬¦

  ```c
  unsigned char getc(void)
  {
      while ((UART1->USR2 & 0x01) == 0); /* æ˜¯å¦å‡†å¤‡å¥½æ¥æ”¶ */
      return UART1->URXD;
  }
  ```

  

- å‘é€å­—ç¬¦ä¸²

  ```c
  /**
   * @brief é€šè¿‡ä¸²å£å‘é€ä¸€ä¸²å­—ç¬¦
   * @param str char *
   */
  void puts(char *str)
  {
      char *p = str;
      while(*p != '\0')
      {
          putc(*p++);
      }
  }
  ```

### printfé…ç½®

- æ·»åŠ å®˜æ–¹çš„æ³¢ç‰¹ç‡è®¡ç®—è®¾ç½®å‡½æ•°

  ```c
  /**
   * @brief        	    : æ³¢ç‰¹ç‡è®¡ç®—å…¬å¼ï¼Œå¯ä»¥ç”¨æ­¤å‡½æ•°è®¡ç®—å‡ºæŒ‡å®šä¸²å£å¯¹åº”çš„UFCRï¼ŒUBIRå’ŒUBMRè¿™ä¸‰ä¸ªå¯„å­˜å™¨çš„å€¼
   * @param base		    : è¦è®¡ç®—çš„ä¸²å£ã€‚
   * @param baudrate	    : è¦ä½¿ç”¨çš„æ³¢ç‰¹ç‡ã€‚
   * @param srcclock_hz	: ä¸²å£æ—¶é’Ÿæºé¢‘ç‡ï¼Œå•ä½Hz
   * @return		: æ— 
   */
  void uart_setbaudrate(UART_Type *base, unsigned int baudrate, unsigned int srcclock_hz)
  ```

  - å‡½æ•°ä¸­ç”¨åˆ°æ•°å­¦åº“ï¼Œç¼–è¯‘æ—¶éœ€è¦æŒ‡å®šè·¯å¾„

    ```makefile
    LIBPATH			:= -lgcc -L /usr/local/arm/gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf/lib/gcc/arm-linux-gnueabihf/4.9.4
    ```

  - ```c
    /* raiseå‡½æ•°é˜²æ­¢ç¼–è¯‘æŠ¥é”™ */
    void raise(int sig_nr)
    {
        
    }
    ```

- æ·»åŠ stdioæ–‡ä»¶

  - ä¿®æ”¹Makefileï¼Œç¼–è¯‘cæ–‡ä»¶æ—¶åŠ å…¥æŒ‡ä»¤-Wa,-mimplicit-it=thumbé¿å…æŠ¥é”™

    ```makefile
    $(COBJS): obj/%.o : %.c
    	$(CC) $(INCLUDE) -Wa,-mimplicit-it=thumb -fno-builtin -c -Wall -nostdlib -O2 -o $@ $<
    ```

- ä¸»å‡½æ•°

  ```c
  while(1){
          printf("è¯·è¾“å…¥ä¸¤ä¸ªæ•´æ•°ï¼Œä½¿ç”¨ç©ºæ ¼éš”å¼€ï¼š");
          scanf("%d %d", &a, &b);
          printf("\r\næ•°æ®%d+%d=%d\r\n", a, b, a+b);
          printf("%dçš„åå…­è¿›åˆ¶ï¼š%#x\r\n", c);
      }
  ```

  
